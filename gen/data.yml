---
CANDigitalInput:
  methods:
    CANDigitalInput:  # constructor
      code: |
        self._device = device
        self._limitSwitch = limitSwitch
        self._hal_data = device._hal_data["limit_switches"][limitSwitch]
        self._hal_data["polarity"] = polarity

    Get:
      get: value
    EnableLimitSwitch:
      set: enable
    IsLimitSwitchEnabled:
      get: enable

CANEncoder:
  methods:
    CANEncoder:  # constructor
      code: |
        self._device = device
        self._hal_data = device._hal_data
    GetPosition:
      get: position
    GetVelocity:
      get: velocity

CANPIDController:
  methods:
    CANPIDController:  # constructor
      code: |
        self._device = device
        self._hal_data = device._hal_data

CANSparkMaxLowLevel:
  methods:
    CANSparkMaxLowLevel:  # constructor
      param_override:
        type:
          x_type: rev::CANSparkMaxLowLevel::MotorType
    GetFirmwareVersion:
      ignore: true  # overload
    SetParameter:
      ignore: true  # overload
    GetParameter:
      ignore: true  # overload

CANSparkMax:
  # __bases__: CANSparkMaxLowLevel
  # cpp_inherits: rev::CANSparkMaxLowLevel

  methods:
    CANSparkMax:  # constructor
      param_override:
        type:
          x_type: rev::CANSparkMaxLowLevel::MotorType
      code: |
        # super().__init__(deviceID, type)
        self._hal_data = NotifyDict({
            "motor_type": type,
            "value": 0.0,
            "inverted": False,
            "position": 0.0,
            "velocity": 0.0,
            "limit_switches": {
                LimitSwitch.kForward: {
                    "value": False,
                    "enable": False,
                    "polarity": None,
                },
                LimitSwitch.kReverse: {
                    "value": False,
                    "enable": False,
                    "polarity": None,
                },
            },
            "idle_mode": IdleMode.kCoast,
            "ramp_rate": 0.0,
        })
        # TODO stick this into the global HAL data

    Set:
      set: value
    Get:
      get: value
    SetInverted:
      set: inverted
    GetInverted:
      get: inverted
    PIDWrite:
      rename: pidWrite
      code: |
        self.set(output)
    GetEncoder:
      code: |
        retval = CANEncoder(self)
    GetPIDController:
      code: |
        retval = CANPIDController(self)
    GetForwardLimitSwitch:
      code: |
        retval = CANDigitalInput(self, LimitSwitch.kForward, polarity)
    GetReverseLimitSwitch:
      code: |
        retval = CANDigitalInput(self, LimitSwitch.kReverse, polarity)
    SetSmartCurrentLimit:
      ignore: true  # overload
    SetIdleMode:
      set: idle_mode
    GetIdleMode:
      get: idle_mode
    SetRampRate:
      set: ramp_rate
    GetRampRate:
      get: ramp_rate
    Follow:
      ignore: true  # overload
    GetFaults:
      code: |
        retval = 0
    GetStickyFaults:
      code: |
        retval = 0
    GetFault:
      code: |
        retval = False
    GetStickyFault:
      code: |
        retval = False
    ClearFaults:
      code: ""
    BurnFlash:
      code: ""
    SetCANTimeout:
      set: can_timeout
